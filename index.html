<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esc치ner Pro - Captura Cajas</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; margin: 0; padding: 20px; background-color: #1a1a1a; color: white; }
        #reader { width: 100%; max-width: 600px; margin: auto; border: 2px solid #007bff; border-radius: 15px; overflow: hidden; background: black; }
        .controles { margin: 20px 0; }
        #lista-escaneos { list-style: none; padding: 0; max-width: 500px; margin: 20px auto; text-align: left; background: #2d2d2d; border-radius: 10px; }
        #lista-escaneos li { padding: 10px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; }
        .btn-copiar { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn-copiar:active { background: #218838; }
        h2 { color: #007bff; }
    </style>
</head>
<body>

    <h2>游닍 Captura de Cajas</h2>
    
    <div id="reader"></div>

    <div class="controles">
        <button class="btn-copiar" onclick="copiarLista()">游늶 Copiar Lista Completa</button>
    </div>

    <h3>Historial de Escaneos:</h3>
    <ul id="lista-escaneos"></ul>

    <audio id="beep" src="https://www.soundjay.com/button/beep-07.wav" preload="auto"></audio>

    <script>
        const listaUI = document.getElementById('lista-escaneos');
        const beep = document.getElementById('beep');
        let codigosGuardados = [];

        function alDetectarCodigo(decodedText) {
            // Evitar escaneos duplicados seguidos muy r치pido
            if (codigosGuardados[0] === decodedText) return;

            // 1. Sonido y Vibraci칩n
            beep.play();
            if (navigator.vibrate) navigator.vibrate(100);

            // 2. Guardar en la lista
            codigosGuardados.unshift(decodedText); // Agrega al inicio
            
            // 3. Actualizar la pantalla
            const nuevoElemento = document.createElement('li');
            nuevoElemento.innerHTML = `<span>${decodedText}</span> <small>${new Date().toLocaleTimeString()}</small>`;
            listaUI.prepend(nuevoElemento);
        }

        function copiarLista() {
            const textoParaCopiar = codigosGuardados.join('\n');
            navigator.clipboard.writeText(textoParaCopiar);
            alert("춰Lista copiada al portapapeles!");
        }

        // Configuraci칩n con visor rectangular para cajas
        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { 
                fps: 15, 
                qrbox: { width: 300, height: 150 }, // Rect치ngulo para barras
                aspectRatio: 1.0 
            }
        );

        html5QrcodeScanner.render(alDetectarCodigo);
    </script>
</body>
</html>
